<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"/>
    <title>OBF3</title>
    <link rel="shortcut icon" type="image/png"
          href="https://github.com/jramseygreen/osu_bot_framework-v3/blob/main/webapp/assets/images/logo_blue.png?raw=true"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!--    custom scroll bar-->
    <style>
        /* width */
        ::-webkit-scrollbar {
            width: 3px;
            height: 6px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #888;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #f1f1f1;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* arrows for ranges */
        input[type=number]::-webkit-inner-spin-button {
            opacity: 1;
        }
    </style>
</head>
<body>
<div id="app" class="container-fluid">
    <div v-if="authenticate && !authenticated">
        <div class="card bg-dark" style="height: 100vh;">
            <h2 class="card-header text-center text-light border-secondary">Welcome to Osu Bot Framework v3!</h2>
            <div class="row">
                <div class="col-6">
                    <div class="text-center mt-4">
                        <img src="https://github.com/jramseygreen/osu_bot_framework-v3/blob/main/webapp/assets/images/logo_blue.png?raw=true"
                                 width="600" height="600" class="mt-4">
                    </div>
                </div>
                <div class="col-6">
                    <div class="card me-4 top-50" style="max-width: 33vw">
                        <h4 class="card-header">Login</h4>
                        <form onsubmit="return false">
                            <div class="card-body">
                                <input id="bot_password_input" type="password" class="form-control" placeholder="osu irc password...">
                                <p id="bot_password_validation" class="fst-italic text-danger"><small></small></p>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary float-end mb-2" onclick="authenticate();">Login</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--    sidebar-->
    <div v-else class="row">
        <div class="col d-flex flex-column text-white bg-dark" style="height: 100vh;">
            <div class="row">
                <span class="col-9">
                    <a href="" class="d-flex mb-3 text-white text-decoration-none">
                        <img src="https://github.com/jramseygreen/osu_bot_framework-v3/blob/main/webapp/assets/images/logo_blue.png?raw=true"
                             width="50" height="50">
                        <h3 class="text-center ms-2">OBF-3</h3>
                    </a>
                </span>
                <span class="col-3">
                    <button class="btn btn-sm float-end btn-danger rounded-pill" onclick="exit_handler()"
                            title="Stop osu bot framework">🔌</button>
                </span>
            </div>
            <hr>
            <span class="fs-4 mb-2">Channels</span>
            <div style="overflow-y: scroll; height: 70vh;">
                <ul class="nav nav-pills flex-column mb-auto" id="channels">
                    <li v-for="channel in channels" class="nav-item active">
                        <span :id="channel" class="nav-link">
                            <a :name="channel" href="javascript:void(0);" aria-current="page" onclick="setChannel(this)"
                               style="text-decoration: none;">
                                <svg class="bi me-2" width="16" height="16"></svg>
                                <span class="text-light">{{channel}}
                            </span>
                            </a>
                            <button :name="channel" type="button" title="Leave Channel"
                                    class="badge badge-sm bg-danger float-end"
                                    onclick="part_channel(this)">X
                            </button>
                        </span>
                    </li>
                </ul>
            </div>
            <hr>
            <!-- Button trigger modal -->
            <button class="nav-link text-white text-center rounded-pill bg-secondary" data-bs-toggle="modal"
                    data-bs-target="#personalMessages">
                Personal Messages
            </button>

            <!-- personal messages -->
            <div class="modal fade" id="personalMessages" tabindex="-1" role="dialog"
                 aria-labelledby="#personalMessagesLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body text-dark">
                            <div class="card text-white bg-secondary text-center">
                                <h3 class="card-title">Personal Messages</h3>
                                <hr>
                                <div class="container">
                                    <div class="card text-white bg-dark">
                                        <div style="overflow-y: scroll; height: 50vh;">
                                            <table class="table text-white" style="table-layout: fixed;">
                                                <thead>
                                                <tr>
                                                    <th class="col-2">From</th>
                                                    <th class="col-2">To</th>
                                                    <th class="col-8">Message</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="message in personal_messages">
                                                    <th>{{message.username}}</th>
                                                    <th>{{message.channel}}</th>
                                                    <td>{{message.content}}</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!--                                    input section-->
                                    <div class="card mb-4">
                                        <form onsubmit="return false">
                                            <div class="input-group mt-1 mb-1">
                                                <input type="text" class="form-control"
                                                       placeholder="Username" style="max-width: 15%;" id="pm_username">
                                                <input type="text" class="form-control"
                                                       placeholder="Say something..." id="personal_message">
                                                <button class="btn btn-dark" type="submit"
                                                        onclick="send_message('personal_message', document.getElementById('pm_username').value)">
                                                    Send
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <!-- make room -->
            <button id="make_room_button" type="button" class="btn btn-primary mb-3" data-bs-toggle="modal"
                    data-bs-target="#makeRoom" onclick="app.make_room.invite_list = [app.bot_username];">
                Make Room
            </button>

            <!-- make room Modal -->
            <div class="modal fade" id="makeRoom" tabindex="-1" role="dialog"
                 aria-labelledby="#makeRoomLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-dark" id="makeRoomLabel">Make a new game room</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!--                        modal body-->
                        <div class="modal-body text-dark">
                            <form id="make_room_form" onsubmit="return false">
                                <div class="mb-3">
                                    <h5 class="text-dark">Room Title</h5>
                                    <input type="text" class="form-control" id="make_room_title">
                                </div>
                                <div class="mb-3">
                                    <h5 class="text-dark">Password</h5>
                                    <input type="text" class="form-control" id="make_room_password">
                                </div>
                            </form>
                            <div class="container mb-4">
                                <div class="row text-center justify-content-center">
                                    <div class="card col-3">
                                        <h5>Game Mode</h5>
                                        <div class="btn-group mb-3">
                                            <button type="button" class="btn btn-dark" disabled>
                                                {{make_room.game_mode}}
                                            </button>
                                            <button type="button"
                                                    class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                <span class="visually-hidden">Toggle Dropdown</span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('game_mode', 'any')">any</a></li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('game_mode', 'osu')">osu</a></li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('game_mode', 'taiko')">taiko</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('game_mode', 'mania')">mania</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('game_mode', 'fruits')">fruits</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="card col-3 mx-2">
                                        <h5>Team Type</h5>
                                        <div class="btn-group mb-3">
                                            <button type="button" class="btn btn-dark" disabled>
                                                {{make_room.team_type}}
                                            </button>
                                            <button type="button"
                                                    class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                <span class="visually-hidden">Toggle Dropdown</span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('team_type', 'any')">any</a></li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('team_type', 'head-to-head')">head-to-head</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('team_type', 'tag-coop')">tag-coop</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('team_type', 'team-vs')">team-vs</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('team_type', 'tag-team-vs')">tag-team-vs</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="card col-3">
                                        <h5>Score Type</h5>
                                        <div class="btn-group mb-3">
                                            <button type="button" class="btn btn-dark" disabled>
                                                {{make_room.scoring_type}}
                                            </button>
                                            <button type="button"
                                                    class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                <span class="visually-hidden">Toggle Dropdown</span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('scoring_type', 'any')">any</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('scoring_type', 'score')">score</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('scoring_type', 'scorev2')">scorev2</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('scoring_type', 'accuracy')">accuracy</a>
                                                </li>
                                                <li><a class="dropdown-item" href="javascript:void(0);"
                                                       @click="make_room_dropdown('scoring_type', 'combo')">combo</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="input-group mb-4">
                                <span class="input-group-text">Beatmap ID</span>
                                <input type="text" class="form-control" value="22538" placeholder="Beatmap ID applied upon creating the room..." onchange="app.make_room.beatmapID = this.value;">
                            </div>
                            <div class="input-group">
                                <span class="input-group-text">Logic Profile</span>
                                <div class="dropdown">
                                      <button class="btn btn-secondary dropdown-toggle" type="button" id="logicProfileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                          {{make_room.logic_profile}}
                                      </button>
                                      <ul class="dropdown-menu" aria-labelledby="logicProfileDropdown">
                                          <li>
                                              <a class="dropdown-item" href="javascript:void(0);" @click="make_room_dropdown('logic_profile', '')">Clear Current Logic Profile</a>
                                          </li>
                                          <li>
                                              <hr class="dropdown-divider">
                                          </li>
                                          <li v-for="profile in logic_profiles">
                                              <a class="dropdown-item" href="javascript:void(0);" @click="make_room_dropdown('logic_profile', profile)">{{profile}}</a>
                                          </li>
                                      </ul>
                                </div>
                            </div>
                            <div class="input-group mt-4">
                                <span class="input-group-text">Room Size</span>
                                <div class="dropdown dropup">
                                  <button class="btn btn-secondary dropdown-toggle" type="button" id="room_size_dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                      {{make_room.size}}
                                  </button>
                                  <ul class="dropdown-menu" aria-labelledby="room_size_dropdown">
                                    <li v-for="i in 16"><a class="dropdown-item" href="#" @click="make_room_dropdown('size', i)">{{i}}</a></li>
                                  </ul>
                                </div>
                            </div>
                            <hr>
                            <h5>Invite Players</h5>
                            <div class="text-center" style="overflow-y: scroll; max-height: 20vh">
                                <table class="table table-secondary table-sm table-striped">
                                    <thead>
                                        <tr>
                                            <th class="col-11">Username</th>
                                            <th class="col-1 text-danger">🗑️</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="user in make_room.invite_list">
                                            <td>{{user}}</td>
                                            <td><button class="badge badge-sm bg-danger" @click="del_invite_list(user)">X</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <form onsubmit="return false">
                                <div class="input-group">
                                    <input id="invite_players_input" class="form-control" type="text" placeholder="username...">
                                    <button class="btn btn-primary" onclick="add_invite_list(this.form);">+</button>
                                </div>
                            </form>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close
                                </button>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                        onclick="make_room(document.getElementById('make_room_form'))">Create
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- join channel -->
            <button type="button" class="btn btn-primary mb-2" data-bs-toggle="modal" data-bs-target="#joinChannel">
                Join Channel
            </button>

            <!-- join channel Modal -->
            <div class="modal fade" id="joinChannel" tabindex="-1" role="dialog"
                 aria-labelledby="#joinChannelLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-dark" id="joinChannelLabel">Join a channel</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <!--                        modal body-->
                        <div class="modal-body text-dark">

                            <form id="join_channel_form" onsubmit="return false">
                                <div class="mb-3">
                                    <h5 class="text-dark">Channel or Match History url to join</h5>
                                    <input type="text" placeholder="e.g. #mp_1234567, #osu, #lobby" class="form-control"
                                           id="join_form_channel">
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close
                                    </button>
                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                            onclick="join_channel(this.form)">
                                        Join
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--        main content-->
        <!--        start page-->
        <div v-if="channel === ''" class="col-10">
            <div class="card text-white bg-dark" style="height: 100vh;">
                <div class="text-center">
                    <h2 class="card-header border-secondary">
                        Welcome to Osu Bot Framework v3!
                    </h2>
                    <img src="https://github.com/jramseygreen/osu_bot_framework-v3/blob/main/webapp/assets/images/logo_blue.png?raw=true"
                         width="600" height="600" class="mt-4">
                    <div class="card bg-dark text-light border-light position-absolute bottom-0 start-50 translate-middle-x">
                        <h5 class="card-header border-secondary">About this project</h5>
                        <div class="card-body">
                            <p>
                                This project was created by
                                <a href="https://osu.ppy.sh/u/qqzzy" class="text-light" target="_blank">qqzzy</a>.
                                For help and documentation, visit the
                                <a href="https://github.com/jramseygreen/osu_bot_framework-v3" class="text-light" target="_blank">GitHub Project</a>
                                page.
                            </p>
                            <p>If you like this project please consider
                                <a href="https://paypal.me/joshuargreen" class="text-light" target="_blank">donating</a>
                                to allow me to continue development.</p>
                        </div>
                        <div class="card-footer border-secondary">
                            <p>Special thanks to
                                <a href="https://osu.ppy.sh/u/martin71" class="text-light" target="_blank">martin71</a>
                                and
                                <a href="https://osu.ppy.sh/u/meowhal" class="text-light" target="_blank">meowhal</a>.
                            </p>
                        </div>
                    </div>
                    <div v-show="channels.length === 0" class="row position-absolute bottom-0 mb-4 ms-1">
                        <h3 class="col-1 text-light">⇦</h3>
                        <div class="col-7 card bg-dark border-secondary">
                            <span class="text-start"> Get started by making a room or joining a channel.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--        channel view-->
        <div v-else class="col-10">
            <div class="card text-white bg-dark" style="height: 100vh;">
                <div class="card-header text-center border-secondary mb-2">
                    <template>
                        <div v-if="title.includes('mp_')">
                            <h2>
                                <a :href="'https://osu.ppy.sh/mp/' + channel.replace('#mp_', '')" target="_blank"
                                   class="text-light" style="text-decoration: none;">
                                    {{title}}
                                </a>
                                <button class="btn btn-secondary rounded-pill float-end" data-bs-toggle="modal" data-bs-target="#editTitleModal">Edit Title</button>
                            </h2>
                            <span>
                                <a :href="config_link" target="_blank" class="text-light">
                                    <small>View configuration page</small>
                                </a>
                                <button class="btn btn-secondary rounded-pill float-end" data-bs-toggle="modal" data-bs-target="#broadcastsModal">Broadcasts</button>
                            </span>

                                <!-- edit title Modal -->
                            <div class="modal fade" id="editTitleModal" tabindex="-1" aria-labelledby="editTitleLabel" aria-hidden="true">
                              <div class="modal-dialog">
                                <div class="modal-content text-dark">
                                  <div class="modal-header">
                                    <h5 class="modal-title" id="editTitleLabel">Edit title</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                  </div>
                                  <div class="modal-body">
                                    <form onsubmit="return false">
                                        <div class="mb-3">
                                            <h5 class="text-start">New title</h5>
                                            <input id="title_input" type="text" class="form-control" placeholder="An interesting title...">
                                        </div>
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="set_title(this.form)">Update title</button>
                                      </div>
                                    </form>
                                  </div>
                                </div>
                              </div>
                            </div>
                        </div>
                        <div v-else>
                            <span>
                                <h2>{{title}}</h2>
                                <button class="btn btn-secondary rounded-pill float-end" data-bs-toggle="modal" data-bs-target="#broadcastsModal">Broadcasts</button>
                            </span>
                        </div>
                    </template>

                    <!-- broadcasts Modal -->
                    <div class="modal fade" id="broadcastsModal" tabindex="-1" aria-labelledby="broadcastsLabel" aria-hidden="true">
                      <div class="modal-dialog modal-xl">
                        <div class="modal-content text-dark">
                          <div class="modal-header">
                            <h5 class="modal-title" id="broadcastsLabel">Message broadcasts</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                              <table class="table table-secondary table-striped" style="table-layout: fixed;">
                                  <thead>
                                  <tr>
                                      <th class="col-1">
                                          ID
                                      </th>
                                      <th class="col-2">
                                          Period(secs)
                                      </th>
                                      <th class="col-8">
                                          Message
                                      </th>
                                      <th class="text-danger col-1">
                                          🗑️
                                      </th>
                                  </tr>
                                  </thead>
                                  <tbody>
                                  <tr v-for="broadcast in broadcasts">
                                      <td>{{broadcast.id}}</td>
                                      <td>{{broadcast.secs}}sec</td>
                                      <td>{{broadcast.message.replace(/ /g, "&nbsp;")}}</td>
                                      <td><button class="badge bg-danger badge-sm" @click="del_broadcast(broadcast.id);">X</button></td>
                                  </tr>
                                  </tbody>
                              </table>
                              <hr>
                              <h5 class="float-start">New message broadcast</h5>
                              <form onsubmit="return false">
                                  <div class="input-group mb-4">
                                      <span class="input-group-text">Period</span>
                                      <input id="broadcast_secs" type="text" class="form-control text-center" style="max-width: 6%;" value="900">
                                      <span class="input-group-text">Message</span>
                                      <input id="broadcast_message" type="text" class="form-control" placeholder="Write your broadcast message here...">
                                      <button class="btn btn-primary" onclick="add_broadcast(this.form);">Add</button>
                                  </div>
                              </form>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
                <span v-show="in_progress && channel.includes('#mp_')"
                      class="badge bg-success">Match In Progress...</span>

                <!--                limits and ranges-->
                <div v-show="channel.includes('#mp_')" class="container card-body text-center">
                    <div class="row">
                        <div class="col-1 card bg-secondary">
                            AR range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_ar" type="number" class="form-control" onchange="set_ar_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_ar" type="number" class="form-control" onchange="set_ar_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            OD range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_od" type="number" class="form-control" onchange="set_od_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_od" type="number" class="form-control" onchange="set_od_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            CS range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_cs" type="number" class="form-control" onchange="set_cs_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_cs" type="number" class="form-control" onchange="set_cs_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            HP range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_hp" type="number" class="form-control" onchange="set_hp_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_hp" type="number" class="form-control" onchange="set_hp_range(this.form);" min="0" max="10" step="0.1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            BPM range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_bpm" type="number" class="form-control" onchange="set_bpm_range(this.form);" min="0" step="1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_bpm" type="number" class="form-control" onchange="set_bpm_range(this.form);" min="-1" step="1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            Time range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_length" type="number" class="form-control" onchange="set_length_range(this.form);" min="0" step="1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_length" type="number" class="form-control" onchange="set_length_range(this.form);" min="-1" step="1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            Diff range
                            <hr>
                            <form onsubmit="return false">
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>min</small></span>
                                    <input id="min_diff" type="number" class="form-control" onchange="set_diff_range(this.form);" min="0" step="0.1" style="font-size:10px;">
                                </div>
                                <div class="input-group input-group-sm mb-1">
                                    <span class="input-group-text" style="width: 40%"><small>max</small></span>
                                    <input id="max_diff" type="number" class="form-control" onchange="set_diff_range(this.form);" min="-1" step="0.1" style="font-size:10px;">
                                </div>
                            </form>
                        </div>
                        <div class="col-1 card bg-secondary">
                            Mode
                            <hr>
                            <div class="btn-group">
                                <button type="button" class="btn btn-dark" disabled>
                                    {{game_mode}}
                                </button>
                                <button type="button"
                                        class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="visually-hidden">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_game_mode('any')">any</a></li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_game_mode('osu')">osu</a></li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_game_mode('taiko')">taiko</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_game_mode('mania')">mania</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_game_mode('fruits')">fruits</a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="col-1 card bg-secondary">
                            Score Type
                            <hr>
                            <div class="btn-group">
                                <button type="button" class="btn btn-dark" disabled>
                                    {{scoring_type}}
                                </button>
                                <button type="button"
                                        class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="visually-hidden">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_scoring_type('any')">any</a></li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_scoring_type('score')">score</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_scoring_type('scorev2')">scorev2</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_scoring_type('accuracy')">accuracy</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_scoring_type('combo')">combo</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-1 card bg-secondary">
                            Team Type
                            <hr>
                            <div class="btn-group">
                                <button type="button" class="btn btn-dark" disabled>
                                    {{team_type}}
                                </button>
                                <button type="button"
                                        class="btn btn-dark dropdown-toggle dropdown-toggle-split"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="visually-hidden">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_team_type('any')">any</a></li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_team_type('head-to-head')">head-to-head</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_team_type('tag-coop')">tag-coop</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_team_type('team-vs')">team-vs</a>
                                    </li>
                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                           onclick="set_team_type('tag-team-vs')">tag-team-vs</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-1 card bg-secondary">
                            Mods
                            <!-- mod select modal -->
                            <button type="button" class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal"
                                    data-bs-target="#modselect" onclick="app.mod_select = [];">Select
                            </button>
                            <hr>
                            <span style="overflow-x: hidden; max-height: 5vh">
                                <span v-for="mod in mods" class="badge bg-dark badge-sm text-light" disabled>
                                    {{mod}}
                                </span>
                            </span>

                            <!-- Modal -->
                            <div class="modal fade" id="modselect" tabindex="-1" aria-labelledby="modselectLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content bg-secondary">
                                        <div class="modal-header">
                                            <h5 class="modal-title text-light" id="modselectLabel">Mod Select</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body text-dark">
                                            <!--row 1-->
                                            <div class="row pb-4">
                                                <div class="col text-start ms-2">
                                                    <button class="btn btn-light ms-4"
                                                            onclick="mod_select_toggle('freemod')">FREEMOD
                                                    </button>
                                                    <span v-show="mod_select.includes('freemod')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                            </div>
                                            <!--row 2-->
                                            <div class="row pb-4">
                                                <div class="col-2">
                                                    <button class="btn btn-success" onclick="mod_select_toggle('ez')">EZ
                                                    </button>
                                                    <span v-show="mod_select.includes('ez')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-2">
                                                    <button class="btn btn-primary" onclick="mod_select_toggle('nf')">NF
                                                    </button>
                                                    <span v-show="mod_select.includes('nf')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-2">
                                                    <button class="btn btn-info"
                                                            onclick="mod_select_toggle('ht')">
                                                        HT
                                                    </button>
                                                    <span v-show="mod_select.includes('ht')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                            </div>
                                            <!--row 3-->
                                            <div class="row pb-4">
                                                <div class="col">
                                                    <button class="btn btn-danger"
                                                            onclick="mod_select_toggle('hr')">HR
                                                    </button>
                                                    <span v-show="mod_select.includes('hr')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col">
                                                    <button class="btn btn-primary"
                                                            onclick="mod_select_toggle('sd')">SD
                                                    </button>
                                                    <span v-show="mod_select.includes('sd')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col">
                                                    <button class="btn btn-info"
                                                            onclick="mod_select_toggle('dt')">DT
                                                    </button>
                                                    <span v-show="mod_select.includes('dt')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col">
                                                    <button class="btn btn-info"
                                                            onclick="mod_select_toggle('nc')">NC
                                                    </button>
                                                    <span v-show="mod_select.includes('nc')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col">
                                                    <button class="btn btn-warning text-secondary"
                                                            onclick="mod_select_toggle('hd')">HD
                                                    </button>
                                                    <span v-show="mod_select.includes('hd')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col">
                                                    <button class="btn btn-warning text-secondary"
                                                            onclick="mod_select_toggle('fl')">FL
                                                    </button>
                                                    <span v-show="mod_select.includes('fl')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                            </div>
                                            <!--row 4-->
                                            <div class="row">
                                                <div class="col-2">
                                                    <button class="btn btn-success"
                                                            onclick="mod_select_toggle('rx')">RX
                                                    </button>
                                                    <span v-show="mod_select.includes('rx')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-2">
                                                    <button class="btn btn-primary"
                                                            onclick="mod_select_toggle('ap')">AP
                                                    </button>
                                                    <span v-show="mod_select.includes('ap')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-2">
                                                    <button class="btn btn-info"
                                                            onclick="mod_select_toggle('so')">SO
                                                    </button>
                                                    <span v-show="mod_select.includes('so')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                                                Cancel
                                            </button>
                                            <button type="button" class="btn btn-dark" data-bs-dismiss="modal"
                                                    onclick="set_mods()">Save changes
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-1 card bg-secondary">
                            Map Status
                            <button type="button" class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal"
                                    data-bs-target="#statusSelect" onclick="app.map_status_select = [];">Select
                            </button>
                            <hr>
                            <span style="overflow-x: hidden; max-height: 5vh">
                                <span v-for="status in map_status" class="badge bg-dark badge-sm text-light">
                                    {{status}}
                                </span>
                            </span>

                            <!-- Modal -->
                            <div class="modal fade" id="statusSelect" tabindex="-1" aria-labelledby="statusSelectLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content bg-secondary">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="statusSelectLabel">Map Status Select</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row pb-4">
                                                <div class="col-3">
                                                    <button class="btn btn-primary"
                                                            onclick="map_status_select_toggle('ranked')">Ranked
                                                    </button>
                                                    <span v-show="map_status_select.includes('ranked')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-3">
                                                    <button class="btn btn-primary"
                                                            onclick="map_status_select_toggle('loved')">Loved
                                                    </button>
                                                    <span v-show="map_status_select.includes('loved')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>

                                                <div class="col-3">
                                                    <button class="btn btn-primary"
                                                            onclick="map_status_select_toggle('qualified')">Qualified
                                                    </button>
                                                    <span v-show="map_status_select.includes('qualified')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-3">
                                                    <button class="btn btn-primary"
                                                            onclick="map_status_select_toggle('approved')">Approved
                                                    </button>
                                                    <span v-show="map_status_select.includes('approved')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                            </div>
                                            <div class="row pb-4">
                                                <div class="col-3">
                                                    <button class="btn btn-info"
                                                            onclick="map_status_select_toggle('pending')">Pending
                                                    </button>
                                                    <span v-show="map_status_select.includes('pending')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-3">
                                                    <button class="btn btn-info"
                                                            onclick="map_status_select_toggle('wip')">WIP
                                                    </button>
                                                    <span v-show="map_status_select.includes('wip')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                                <div class="col-3">
                                                    <button class="btn btn-info"
                                                            onclick="map_status_select_toggle('graveyard')">Graveyard
                                                    </button>
                                                    <span v-show="map_status_select.includes('graveyard')"
                                                          class="top-0 badge rounded-pill bg-danger">✓</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                                                Cancel
                                            </button>
                                            <button type="button" class="btn btn-dark" onclick="set_map_status()"
                                                    data-bs-dismiss="modal">Save changes
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row">
                        <!--                    players-->
                        <div class="col-3">
                            <div class="card text-white bg-secondary">
                                <div v-if="channel.includes('mp_')">
                                        <button class="card-header badge bg-light text-dark" data-bs-toggle="modal" data-bs-target="#sizeModal" title="Change room size">{{total_users}}</button>
                                    </div>
                                    <div v-else>
                                        <span class="card-header badge bg-light text-dark">{{total_users}}</span>
                                    </div>
                                <h3 class="text-center mt-2">

                                    Players
                                    <button v-show="channel.includes('mp_')" class="btn btn-sm btn-dark rounded-pill ms-4" onclick="document.getElementById('global_blacklist').checked = false;" data-bs-toggle="modal" data-bs-target="#playerBlacklistModal">blacklist</button>
                                </h3>

<!--                                size modal-->
                                <div class="modal fade" id="sizeModal" tabindex="-1" aria-labelledby="sizeModalLabel" aria-hidden="true">
                                  <div class="modal-dialog">
                                    <div class="modal-content bg-secondary">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="sizeModalLabel">Set room size</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                      </div>
                                      <div class="modal-body">
                                        <div class="row">
                                            <div class="col">
                                                <h5>Select Size:</h5>
                                            </div>
                                            <div class="col">
                                                <div class="dropdown">
                                                      <button class="btn btn-dark dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
                                                          {{size}}
                                                      </button>
                                                      <ul class="dropdown-menu bg-secondary" aria-labelledby="dropdownMenuButton2">
                                                            <li v-for="i in 16"><a class="dropdown-item text-light" href="javascript:void(0);" @click="set_size(i)" data-bs-dismiss="modal">{{i}}</a></li>
                                                      </ul>
                                                </div>
                                            </div>
                                        </div>
                                      </div>
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                <!--player blacklist modal-->
                                <div class="modal fade" id="playerBlacklistModal" tabindex="-1" aria-labelledby="playerBlacklistLabel" aria-hidden="true">
                                  <div class="modal-dialog">
                                    <div class="modal-content bg-secondary">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="playerBlacklistLabel">Player blacklist</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                      </div>
                                      <div class="modal-body">
                                          <div style="overflow-y: scroll; max-height: 40vh;">
                                            <table class="table table-secondary table-striped">
                                                <thead>
                                                <tr>
                                                    <th class="col-11">Username</th>
                                                    <th class="text-danger col-1">🗑️</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="username in player_blacklist">
                                                    <td>{{username}}</td>
                                                    <td><button class="badge bg-danger badge-sm" @click="del_player_blacklist(username)">X</button></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                          </div>
                                        <hr>
                                          <h5 class="float-start">Add to blacklist</h5>
                                          <form onsubmit="return false">
                                              <div class="input-group mb-4">
                                                  <input id="blacklist_username" type="text" class="form-control" placeholder="Add a player to the blacklist...">
                                                  <button class="btn btn-primary" onclick="add_player_blacklist(this.form);">Add</button>
                                              </div>
                                              <input class="form-check-input" type="checkbox" id="global_blacklist">
                                              Add to global blacklist
                                          </form>
                                      </div>
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                <hr>
                                <div id="players" style="overflow-y: scroll; overflow-x: hidden; height: 57vh; max-height: 600px"
                                     onscroll="lazy_load(this);">
                                    <table class="table table-sm text-white">
                                        <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Username</th>
                                            <th scope="col">Badges</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <template>
                                            <tr v-for="(slot, index) in slots" v-if="index < user_num">
                                                <th scope="row">{{parseInt(index) + 1}}</th>
                                                <td v-if="channel.includes('#mp')"><a class="text-light" href="javascript:void(0)"
                                                       style="text-decoration: none;" data-bs-toggle="modal"
                                                       data-bs-target="#playerModal"
                                                       @click="set_current_username(slot.username);">{{slot.username.replace(/ /g, "&nbsp;")}}</a>
                                                </td>
                                                <td v-else>
                                                    {{slot.username}}
                                                </td>
                                                <!--badges-->
                                                <td>
                                                    <span v-show="slot.username === host && host !== '' && channel.includes('mp_')"
                                                          :slot="slot" title="Host"
                                                          class="badge bg-dark text-warning">♔</span>
                                                    <span v-show="slot.team === 'red' && channel.includes('mp_')"
                                                          :slot="slot" title="Red Team"
                                                          class="badge bg-danger text-light">Red</span>
                                                    <span v-show="slot.team === 'blue' && channel.includes('mp_')"
                                                          :slot="slot" title="Blue Team"
                                                          class="badge bg-primary text-light">Blue</span>
                                                    <span v-show="referees.includes(slot.username.replace(/ /g, '_')) && channel.includes('mp_')"
                                                          :slot="slot" title="Referee"
                                                          class="badge bg-dark text-success">🛡️</span>
                                                </td>
                                            </tr>
                                            <!-- user card Modal -->
                                            <div class="modal fade" id="playerModal" tabindex="-1"
                                                 aria-labelledby="playerModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content bg-secondary">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="playerModalLabel">
                                                                <div class="row">
                                                                    <div class="col-4">
                                                                        <div v-if="current_username !== ''">
                                                                            <a :href="'https://osu.ppy.sh/u/' + current_username" style="text-decoration: none;" target="_blank">
                                                                                <img :src="current_user_profile.avatar_url" class="img-thumbnail" width="100" height="100">
                                                                            </a>
                                                                        </div>
                                                                        <div v-else>
                                                                            <a href="https://raw.githubusercontent.com/jramseygreen/osu_bot_framework-v3/main/webapp/assets/images/default_pfp.png" style="text-decoration: none;" target="_blank">
                                                                                <img :src="current_user_profile.avatar_url" class="img-thumbnail" width="100" height="100">
                                                                            </a>
                                                                        </div>
                                                                        <div class="text-center mt-3">
                                                                            <img :src="'https://www.geonames.org/flags/x/' + current_user_profile.country_code + '.gif'" width="40" height="20">
                                                                            <span class="text-uppercase">{{current_user_profile.country_code}}</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-8">
                                                                        <a class="text-light" :href="'https://osu.ppy.sh/u/' + current_username" style="text-decoration: none;" target="_blank">
                                                                            {{current_username.replace(/ /g, "&nbsp;")}}
                                                                            #{{current_user_profile.statistics.global_rank}}
                                                                            (lvl {{current_user_profile.statistics.level.current}})
                                                                        </a>
                                                                        <hr>
                                                                        <h6>Performance: {{current_user_profile.statistics.pp}}pp</h6>
                                                                        <h6>Accuracy: {{current_user_profile.statistics.hit_accuracy}}%</h6>
                                                                        <h6>Play Count: {{current_user_profile.statistics.play_count}}</h6>
                                                                    </div>
                                                                </div>
                                                            </h5>
                                                        </div>
                                                        <div class="modal-body text-center">
                                                            <div class="card border-0 bg-secondary">
                                                                <button class="btn btn-primary mb-4" onclick="window.open('https://osu.ppy.sh/u/' + app.current_username, '_blank');">
                                                                    View Profile
                                                                </button>
                                                            </div>
                                                            <div v-show="users.includes(current_username)" class="card border-0 bg-secondary">
                                                                <button class="btn btn-success mb-4"
                                                                        data-bs-dismiss="modal" onclick="set_host();">
                                                                    Transfer Host
                                                                </button>
                                                            </div>
                                                            <div v-show="users.includes(current_username)" class="card border-0 bg-secondary">
                                                                <button class="btn btn-warning mb-4"
                                                                        data-bs-dismiss="modal" onclick="kick_user();">
                                                                    Kick Player
                                                                </button>
                                                            </div>
                                                            <div class="card border-0 bg-secondary">
                                                                <button class="btn btn-danger mb-4"
                                                                        data-bs-dismiss="modal" onclick="add_player_blacklist(null);">
                                                                    Blacklist Player
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-danger"
                                                                    data-bs-dismiss="modal" onclick="app.current_username = ''">Close
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!--                    chat-->
                        <div class="col-7">
                            <div class="card text-white bg-secondary text-center">
                                <h3 class="card-title">Chat</h3>
                                <hr>
                                <div class="container">
                                    <div class="card text-white bg-dark text-start">
                                        <div id="chat_div" style="overflow-y: scroll; height: 50vh; max-height: 600px">
                                            <table id="chat" class="table table-sm text-white" style="table-layout: fixed;">
                                                <tbody>
                                                <tr v-for="message in messages">
                                                    <td class="col-12">
                                                        <span v-if="message.username === 'BanchoBot'" :message="message" class="badge bg-secondary text-danger">{{message.username}}</span>
                                                        <span v-else class="badge bg-secondary">{{message.username}}
                                                            <span v-show="message.username === host.replace(/ /g, '_')" :message="message" class="badge bg-dark text-warning" title="Host">♔</span>
                                                            <span v-show="referees.includes(message.username)" :message="message" class="badge bg-dark text-success" title="Referee">🛡️</span>
                                                        </span>
                                                        <p class="ms-1">{{message.content.replace(/ /g, "&nbsp;")}}</p>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!--                                    input section-->
                                    <div class="card mb-4">
                                        <form onsubmit="return false">
                                            <div class="input-group mt-1 mb-1">
                                                <input id="channel_message" type="text" class="form-control"
                                                       placeholder="Say something...">
                                                <button class="btn btn-dark" type="submit"
                                                        onclick="send_message('channel_message', app.channel)">Send
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-2">
                            <!--                        beatmap-->
                            <div v-show="channel.includes('#mp_')" class="card bg-secondary mb-2">
                                <h3 class="card-header text-center">Beatmap</h3>
                                <a :href="beatmap.url" target="_blank" style="text-decoration: none;">
                                    <h5 class="text-center text-light mt-2">{{beatmapName}}</h5>
                                    <hr style="background-color: #f1f1f1">
                                    <img :src="beatmapImage"
                                         class="rounded"
                                         width="190" style="max-width: 100%;">
                                </a>
                                <hr>
                                <div class="mb-3 text-center">
                                    <div v-if="Object.keys(beatmap).length > 2">
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.difficulty_rating}} ★</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmapLength}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.mode}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.status}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">{{beatmap.bpm}} BPM</span>
                                        <span class="badge rounded-pill bg-info text-dark">AR {{beatmap.ar}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">OD {{beatmap.accuracy}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">CS {{beatmap.cs}}</span>
                                        <span class="badge rounded-pill bg-info text-dark">HP {{beatmap.drain}}</span>
                                    </div>
                                    <div v-else>
                                        <span class="badge rounded-pill bg-info text-dark">Unsubmitted</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card bg-secondary">
                                <!--                            buttons-->
                                <div class="dropdown text-center">
                                    <h6>Logic Profile</h6>
                                    <button class="btn btn-secondary dropdown-toggle" type="button"
                                            id="dropdownMenuButton1" data-bs-toggle="dropdown"
                                            aria-expanded="false">
                                        <span class="text-light">{{logic_profile}}</span>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="logicProfiles">
                                        <li><a class="dropdown-item"
                                               href="javascript:void(0);"
                                               id=""
                                               onclick="set_logic_profile(this)">Clear Current Logic Profile</a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                        <li v-for="profile in logic_profiles"><a class="dropdown-item"
                                                                                 href="javascript:void(0);"
                                                                                 :id="profile"
                                                                                 onclick="set_logic_profile(this)">{{profile}}</a>
                                        </li>
                                    </ul>
                                </div>
                                <div v-show="channel.includes('#mp_')">
                                    <table class="table">
                                        <tbody>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <button type="button" class="btn btn-success" onclick="start_match()"><small>Start Match</small></button>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-danger" onclick="abort_match()"><small>Abort Match</small></button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <button type="button" class="btn btn-dark" onclick="close_room()"><small>Close Room</small></button>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editPasswordModal"><small>Edit Password</small></button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                                    <!--edit password Modal -->
                                    <div class="modal fade" id="editPasswordModal" tabindex="-1" aria-labelledby="editPasswordLabel" aria-hidden="true">
                                      <div class="modal-dialog">
                                        <div class="modal-content bg-secondary">
                                          <div class="modal-header">
                                              <span>
                                                <h5 class="modal-title" id="editPasswordLabel">Edit password</h5>
                                                <small class="fst-italic">(current password: <span class="text-warning">{{password}}</span>)</small>
                                              </span>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                              <h5>New Password</h5>
                                              <form onsubmit="return false">
                                                  <input id="password_input" type="text" class="form-control mb-4">
                                                  <div class="modal-footer">
                                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="set_password(this.form);">Save changes</button>
                                                  </div>
                                              </form>
                                          </div>
                                        </div>
                                      </div>
                                    </div>

                                    <button type="button"
                                            class="btn rounded-pill btn-warning text-secondary col-11 ms-2 mb-3" onclick="reset_advanced_options();" data-bs-toggle="modal" data-bs-target="#AdvancedOptionsModal">
                                        Advanced Options
                                    </button>

                                    <!-- advanced options Modal -->
                                    <div class="modal fade" id="AdvancedOptionsModal" tabindex="-1" aria-labelledby="AdvancedOptionsLabel" aria-hidden="true">
                                      <div class="modal-dialog modal-lg">
                                        <div class="modal-content bg-secondary">
                                          <div class="modal-header">
                                            <h5 class="modal-title" id="AdvancedOptionsLabel">Advanced Options</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                              <form id="advanced_options_form" onsubmit="return false">
                                                  <div class="form-check form-switch">
                                                      <input id="beatmap_checker_switch" class="form-check-input" type="checkbox">
                                                      Beatmap checker
                                                  </div>
                                                  <hr>
                                                  <div class="form-check form-switch">
                                                      <input id="allow_conversion_switch" class="form-check-input" type="checkbox">
                                                      Allow beatmap conversion
                                                  </div>
                                                  <div class="form-check form-switch">
                                                      <input id="allow_unsubmitted_switch" class="form-check-input" type="checkbox">
                                                      Allow unsubmitted beatmaps
                                                  </div>
                                                  <hr>
                                                  <div class="form-check form-switch">
                                                      <input id="maintain_title_switch" class="form-check-input" type="checkbox">
                                                      Maintain room title
                                                  </div>
                                                  <div class="form-check form-switch">
                                                      <input id="maintain_password_switch" class="form-check-input" type="checkbox">
                                                      Maintain room password
                                                  </div>
                                                  <div class="form-check form-switch">
                                                      <input id="maintain_size_switch" class="form-check-input" type="checkbox">
                                                      Maintain room size
                                                  </div>
                                                  <hr>
                                                  <div class="form-check form-switch">
                                                      <input id="autostart_switch" class="form-check-input" type="checkbox">
                                                      Start match automatically when all players are ready
                                                  </div>
                                                  <div class="form-check form-switch mb-4">
                                                      <input id="autostart_timer_switch" class="form-check-input" type="checkbox">
                                                      Queue match to start when beatmap is selected (in seconds)
                                                      <div class="col-1 float-end input-group-sm">
                                                          <input id="autostart_timer_input" type="text" class="form-control text-center">
                                                      </div>
                                                  </div>
                                                  <div class="form-check form-switch">
                                                      <input id="welcome_message_switch" class="form-check-input" type="checkbox">
                                                      Welcome message
                                                      <div class="col-9 float-end input-group-sm">
                                                          <input id="welcome_message_input" type="text" class="form-control" placeholder="Write something...">
                                                      </div>
                                                  </div>
                                                  <hr>
                                                  <div class="form-check form-switch">
                                                      <input id="auto_download_switch" class="form-check-input" type="checkbox">
                                                      Download beatmaps automatically from BeatConnect.io
                                                      <div class="col-4 float-end input-group-sm">
                                                          <input id="auto_download_path" type="text" class="form-control" placeholder="(Optional) Save path...">
                                                      </div>
                                                  </div>
                                                  <div class="form-check form-switch">
                                                      <input id="download_video_switch" class="form-check-input" type="checkbox">
                                                      Download with video (if available)
                                                  </div>
                                                  <div class="form-check form-switch">
                                                      <input id="auto_open_switch" class="form-check-input" type="checkbox">
                                                      Open beatmaps automatically after downloading
                                                  </div>
                                                  <div class="row">
                                                      <div class="col-5">
                                                          <div class="form-check form-switch">
                                                              <input id="redownload_owned_beatmaps" class="form-check-input" type="checkbox">
                                                              Redownload owned beatmaps
                                                          </div>
                                                      </div>
                                                      <div class="col-1"></div>
                                                      <div class="col-6">
                                                          <div class="input-group input-group-sm float-end" title="Your osu directory is used to check for owned beatmaps">
                                                              <div class="ms-2"></div>
                                                              <span class="input-group-text ms-4">osu directory</span>
                                                              <input id="osu_directory" type="text" class="form-control" placeholder="osu directory...">
                                                          </div>
                                                      </div>
                                                  </div>

<!--                                                  whitelists / blacklists-->
                                                  <hr>
                                                  <div class="row text-center">
                                                      <div class="col-6">
                                                          <div class="card bg-secondary">
                                                              <h6>Artist Whitelist</h6>
                                                              <div style="overflow-y: scroll; max-height: 15vh">
                                                                  <table class="table table-sm table-secondary table-striped">
                                                                      <thead>
                                                                      <tr>
                                                                          <th class="col-11">Artist</th>
                                                                          <th class="text-danger col-1">🗑️</th>
                                                                      </tr>
                                                                      </thead>
                                                                      <tbody>
                                                                      <tr v-for="artist in artist_whitelist">
                                                                          <td>{{artist}}</td>
                                                                          <td><button class="badge badge-sm bg-danger" @click="del_artist_whitelist(artist)">X</button></td>
                                                                      </tr>
                                                                      </tbody>
                                                                  </table>
                                                              </div>
                                                              <form onsubmit="return false">
                                                                  <div class="input-group">
                                                                      <input id="artist_whitelist_input" type="text" class="form-control" placeholder="Artist to whitelist">
                                                                      <button class="btn btn-primary" onclick="add_artist_whitelist(this.form)">+</button>
                                                                  </div>
                                                              </form>
                                                          </div>
                                                      </div>
                                                      <div class="col-6">
                                                          <div class="card bg-secondary">
                                                              <h6>Artist Blacklist</h6>
                                                              <div style="overflow-y: scroll; max-height: 15vh">
                                                                  <table class="table table-sm table-secondary table-striped">
                                                                      <thead>
                                                                      <tr>
                                                                          <th class="col-11">Artist</th>
                                                                          <th class="text-danger col-1">🗑️</th>
                                                                      </tr>
                                                                      </thead>
                                                                      <tbody>
                                                                      <tr v-for="artist in artist_blacklist">
                                                                          <td>{{artist}}</td>
                                                                          <td><button class="badge badge-sm bg-danger" @click="del_artist_blacklist(artist)">X</button></td>
                                                                      </tr>
                                                                      </tbody>
                                                                  </table>
                                                              </div>
                                                              <form onsubmit="return false">
                                                                  <div class="input-group">
                                                                      <input id="artist_blacklist_input" type="text" class="form-control" placeholder="Artist to blacklist">
                                                                      <button class="btn btn-primary" onclick="add_artist_blacklist(this.form)">+</button>
                                                                  </div>
                                                              </form>
                                                          </div>
                                                      </div>
                                                  </div>
                                                  <hr>
                                                  <div class="row text-center mb-2">
                                                      <div class="col-6">
                                                          <div class="card bg-secondary">
                                                              <h6>Beatmap Creator Whitelist</h6>
                                                              <div style="overflow-y: scroll; max-height: 15vh">
                                                                  <table class="table table-sm table-secondary table-striped">
                                                                      <thead>
                                                                      <tr>
                                                                          <th class="col-11">Beatmap Creator</th>
                                                                          <th class="text-danger col-1">🗑️</th>
                                                                      </tr>
                                                                      </thead>
                                                                      <tbody>
                                                                      <tr v-for="creator in creator_whitelist">
                                                                          <td>{{creator}}</td>
                                                                          <td><button class="badge badge-sm bg-danger" @click="del_creator_whitelist(creator)">X</button></td>
                                                                      </tr>
                                                                      </tbody>
                                                                  </table>
                                                              </div>
                                                              <form onsubmit="return false">
                                                                  <div class="input-group">
                                                                      <input id="creator_whitelist_input" type="text" class="form-control" placeholder="Beatmap creator to whitelist">
                                                                      <button class="btn btn-primary" onclick="add_creator_whitelist(this.form)">+</button>
                                                                  </div>
                                                              </form>
                                                          </div>
                                                      </div>
                                                      <div class="col-6">
                                                          <div class="card bg-secondary">
                                                              <h6>Beatmap Creator Blacklist</h6>
                                                              <div style="overflow-y: scroll; max-height: 15vh">
                                                                  <table class="table table-sm table-secondary table-striped">
                                                                      <thead>
                                                                      <tr>
                                                                          <th class="col-11">Beatmap Creator</th>
                                                                          <th class="text-danger col-1">🗑️</th>
                                                                      </tr>
                                                                      </thead>
                                                                      <tbody>
                                                                      <tr v-for="creator in creator_blacklist">
                                                                          <td>{{creator}}</td>
                                                                          <td><button class="badge badge-sm bg-danger" @click="del_creator_blacklist(creator)">X</button></td>
                                                                      </tr>
                                                                      </tbody>
                                                                  </table>
                                                              </div>
                                                              <form onsubmit="return false">
                                                                  <div class="input-group">
                                                                      <input id="creator_blacklist_input" type="text" class="form-control" placeholder="Beatmap creator to blacklist">
                                                                      <button class="btn btn-primary" onclick="add_creator_blacklist(this.form)">+</button>
                                                                  </div>
                                                              </form>
                                                          </div>
                                                      </div>
                                                  </div>
                                                  <div class="modal-footer">
                                                      <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                                      <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="set_advanced_options();">Save changes</button>
                                                  </div>
                                              </form>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
    var host = "ws://localhost:9876/";
    if (!window.location.href.includes(host.split(":")[1])) {
        host = "ws://" + window.location.href.slice(0, -1).replace("http://", "").split(":")[0] + ":" + host.split(":")[2];
    }
    var sock = new WebSocket(host);
    var polling = false;
    var exit = false;
    var buffer;
    var app;
    window.onload = function () {
        sock.onclose = function () {
            if (exit) {
                document.body.innerHTML = '<div class="bg-dark text-light text-center" style="height: 100vh; width: 100vw;"><h5><span class="badge bg-success">Exited osu bot framework successfully!</span></h5><img src="https://github.com/jramseygreen/osu_bot_framework-v3/blob/main/webapp/assets/images/logo_blue.png?raw=true" width="600" height="600" class="mt-4 mb-4"><p mt-4>See you next time...</p></div>';
            } else {
                document.body.innerHTML = '<div class="bg-dark text-light text-center" style="height: 100vh; width: 100vw;"><h5><span class="badge bg-danger text-light">The connection to the back end was lost! Please <a href="">refresh</a> the page!</span></h5><a href=""><img src="https://github.com/jramseygreen/osu_bot_framework-v3/blob/main/webapp/assets/images/logo_red.png?raw=true" width="600" height="600" class="mt-4"></a></div>';
            }
            exit = true;
        };

        sock.onerror = function (error) {
            console.log('WebSocket Error ' + error);
        };

        sock.onmessage = function (e) {
            if (!polling) {
                update_poll();
            }
            message = e.data;
            if (message === "authenticate") {
                console.log('Server: ' + message);
                app.authenticate = true;
                if (document.cookie !== "" && document.cookie !== "-") {
                    console.log("cookies: " + document.cookie);
                    cookies = {};
                    try {
                        cookies = JSON.parse(document.cookie);
                        app.bot_password = cookies["bot_password"];
                        sock.send(encrypt(JSON.stringify({"command": "authenticate"})));
                    } catch(e) {
                        document.cookie = "-";
                    }
                }
                return;
            }
            if (message === "success") {
                app.authenticated = true;
            }
            if (app.authenticate) {
                try {
                    message = decrypt(message);
                } catch(e) {
                    return;
                }
            }
            console.log('Server: ' + message);
            buffer = {};
            try {
                buffer = JSON.parse(message);
                app.authenticated = true;
            } catch(e) {
                return;
            }
            if (message !== JSON.stringify(app.buffer)) {
                app.buffer = buffer;
                app.channels = Object.keys(buffer["channels"]);
                app.personal_messages = buffer["pm"];
                app.logic_profiles = buffer["logic_profiles"];
                app.bot_username = buffer["bot_username"];
                app.redownload_owned_beatmaps = buffer["redownload_owned_beatmaps"];
                app.osu_directory = buffer["osu_directory"];
                if (app.make_room.invite_list.includes("")) {
                    app.make_room.invite_list = [app.bot_username];
                }
                if (app.channel !== "" && app.channels.includes(app.channel)) {
                    app.title = app.channel;
                    app.logic_profile = buffer["channels"][app.channel]["logic_profile"];
                    app.slots = buffer["channels"][app.channel]["slots"];
                    app.messages = buffer["channels"][app.channel]["messages"];
                    app.users = buffer["channels"][app.channel]["users"];
                    app.total_users = buffer["channels"][app.channel]["total_users"];
                    app.broadcasts = buffer["channels"][app.channel]["broadcasts"];
                    if (app.channel.includes("#mp_")) {
                        app.title += " - " + buffer["channels"][app.channel]["title"];
                        app.config_link = buffer["channels"][app.channel]["config_link"];
                        app.host = buffer["channels"][app.channel]["host"];
                        app.referees = buffer["channels"][app.channel]["referees"];
                        app.in_progress = buffer["channels"][app.channel]["in_progress"];
                        app.beatmap = buffer["channels"][app.channel]["beatmap"];
                        app.beatmapName = buffer["channels"][app.channel]["beatmap_name"];
                        app.beatmapImage = "https://assets.ppy.sh/beatmaps/" + buffer["channels"][app.channel]["beatmap"]["beatmapset_id"] + "/covers/cover.jpg";
                        if (Math.floor(app.beatmap["total_length"] / 60) > 0) {
                            app.beatmapLength = Math.floor(app.beatmap["total_length"] / 60) + "min " + app.beatmap["hit_length"] % 60 + "sec";
                        } else {
                            app.beatmapLength = app.beatmap["total_length"] + "sec";
                        }
                        app.password = buffer["channels"][app.channel]["password"];
                        app.game_mode = buffer["channels"][app.channel]["game_mode"];
                        app.team_type = buffer["channels"][app.channel]["team_type"];
                        app.scoring_type = buffer["channels"][app.channel]["scoring_type"];
                        app.mods = buffer["channels"][app.channel]["mods"];
                        app.map_status = buffer["channels"][app.channel]["map_status"];
                        app.player_blacklist = buffer["channels"][app.channel]["player_blacklist"];
                        app.beatmap_checker = buffer["channels"][app.channel]["beatmap_checker"];
                        app.allow_unsubmitted = buffer["channels"][app.channel]["allow_unsubmitted"];
                        app.allow_convert = buffer["channels"][app.channel]["allow_convert"];
                        app.maintain_title = buffer["channels"][app.channel]["maintain_title"];
                        app.maintain_password = buffer["channels"][app.channel]["maintain_password"];
                        app.maintain_size = buffer["channels"][app.channel]["maintain_size"];
                        app.start_on_players_ready = buffer["channels"][app.channel]["start_on_players_ready"];
                        app.artist_whitelist = buffer["channels"][app.channel]["artist_whitelist"];
                        app.artist_blacklist = buffer["channels"][app.channel]["artist_blacklist"];
                        app.creator_whitelist = buffer["channels"][app.channel]["creator_whitelist"];
                        app.creator_blacklist = buffer["channels"][app.channel]["creator_blacklist"];
                        app.autostart_timer = buffer["channels"][app.channel]["autostart_timer"];
                        app.welcome_message = buffer["channels"][app.channel]["welcome_message"];
                        app.current_user_profile = buffer["current_user_profile"];
                        app.auto_download = buffer["channels"][app.channel]["auto_download"];
                        app.size = buffer["channels"][app.channel]["size"];

                        if (JSON.stringify(buffer["channels"][app.channel]["ar_range"]) !== JSON.stringify(app.ar_range)) {
                            app.ar_range = buffer["channels"][app.channel]["ar_range"]
                            document.getElementById("min_ar").value = app.ar_range[0];
                            document.getElementById("max_ar").value = app.ar_range[1];
                        }

                        if (JSON.stringify(buffer["channels"][app.channel]["od_range"]) !== JSON.stringify(app.od_range)) {
                            app.od_range = buffer["channels"][app.channel]["od_range"]
                            document.getElementById("min_od").value = app.od_range[0];
                            document.getElementById("max_od").value = app.od_range[1];
                        }

                        if (JSON.stringify(buffer["channels"][app.channel]["cs_range"]) !== JSON.stringify(app.cs_range)) {
                            app.cs_range = buffer["channels"][app.channel]["cs_range"]
                            document.getElementById("min_cs").value = app.cs_range[0];
                            document.getElementById("max_cs").value = app.cs_range[1];
                        }

                        if (JSON.stringify(buffer["channels"][app.channel]["hp_range"]) !== JSON.stringify(app.hp_range)) {
                            app.hp_range = buffer["channels"][app.channel]["hp_range"]
                            document.getElementById("min_hp").value = app.hp_range[0];
                            document.getElementById("max_hp").value = app.hp_range[1];
                        }

                        if (JSON.stringify(buffer["channels"][app.channel]["bpm_range"]) !== JSON.stringify(app.bpm_range)) {
                            app.bpm_range = buffer["channels"][app.channel]["bpm_range"]
                            document.getElementById("min_bpm").value = app.bpm_range[0];
                            document.getElementById("max_bpm").value = app.bpm_range[1];
                        }

                        if (JSON.stringify(buffer["channels"][app.channel]["length_range"]) !== JSON.stringify(app.length_range)) {
                            app.length_range = buffer["channels"][app.channel]["length_range"]
                            document.getElementById("min_length").value = app.length_range[0];
                            document.getElementById("max_length").value = app.length_range[1];
                        }

                        if (JSON.stringify(buffer["channels"][app.channel]["diff_range"]) !== JSON.stringify(app.diff_range)) {
                            app.diff_range = buffer["channels"][app.channel]["diff_range"]
                            document.getElementById("min_diff").value = app.diff_range[0];
                            document.getElementById("max_diff").value = app.diff_range[1];
                        }
                    }
                } else {
                    if (app.channel !== "" && !app.channels.includes(app.channel)) {
                        location.reload();
                    }
                    app.channel = "";
                }
            }
        };
        update_poll();
    };

    app = new Vue({
        el: "#app",
        data: {
            authenticate: false,
            authenticated: false,
            buffer: {},
            config_link: "",
            channel: "",
            logic_profiles: [],
            logic_profile: "",
            slots: {},
            users: [],
            total_users: 0,
            user_num: 20,
            size: 0,
            referees: [],
            host: "",
            channels: [],
            in_progress: false,
            messages: [],
            beatmap: {},
            beatmapName: "",
            beatmapImage: "",
            beatmapLength: "",
            personal_messages: [],
            title: "",
            password: "",
            make_room: {
                "game_mode": "any",
                "scoring_type": "any",
                "team_type": "any",
                "logic_profile": "",
                "invite_list": [],
                "size": 16,
                "beatmapID": 22538
            },
            game_mode: "",
            scoring_type: "",
            team_type: "",
            mods: [],
            mod_select: [],
            map_status: [],
            map_status_select: [],
            ar_range: [],
            od_range: [],
            cs_range: [],
            hp_range: [],
            bpm_range: [],
            length_range: [],
            diff_range: [],
            current_username: "",
            current_user_profile: {
                "avatar_url": "",
                "country_code": "gb",
                "statistics": {
                    "level": {
                        "current": 0
                    },
                    "global_rank": 0,
                    "pp": 0,
                    "hit_accuracy": 0,
                    "play_count": 0
                }
            },
            broadcasts: [],
            artist_whitelist: [],
            artist_blacklist: [],
            creator_whitelist: [],
            creator_blacklist: [],
            player_blacklist: [],
            beatmap_checker: false,
            allow_unsubmitted: true,
            allow_convert: true,
            maintain_title: false,
            maintain_password: false,
            maintain_size: false,
            start_on_players_ready: false,
            welcome_message: "",
            autostart_timer: -1,
            auto_download: {},
            bot_username: "",
            bot_password: "",
            redownload_owned_beatmaps: false,
            osu_directory: ""
        },
        methods: {
            set_current_username: function (username) {
                this.current_username = username;
                payload = {
                    "command": "fetch_user_profile",
                    "channel": app.channel,
                    "username": username
                };
                send(JSON.stringify(payload));
            },
            del_broadcast: function (broadcast_id) {
                payload = {
                    "command": "del_broadcast",
                    "channel": app.channel,
                    "broadcast_id": broadcast_id
                };
                send(JSON.stringify(payload));
            },
            del_player_blacklist: function (username) {
                payload = {
                    "command": "del_player_blacklist",
                    "channel": app.channel,
                    "username": username
                };
                send(JSON.stringify(payload));
            },
            del_artist_whitelist: function (artist) {
                payload = {
                    "command": "del_artist_whitelist",
                    "channel": app.channel,
                    "artist": artist
                };
                send(JSON.stringify(payload));
            },
            del_artist_blacklist: function (artist) {
                payload = {
                    "command": "del_artist_blacklist",
                    "channel": app.channel,
                    "artist": artist
                };
                send(JSON.stringify(payload));
            },
            del_creator_whitelist: function (creator) {
                payload = {
                    "command": "del_creator_whitelist",
                    "channel": app.channel,
                    "creator": creator
                };
                send(JSON.stringify(payload));
            },
            del_creator_blacklist: function (creator) {
                payload = {
                    "command": "del_creator_blacklist",
                    "channel": app.channel,
                    "creator": creator
                };
                send(JSON.stringify(payload));
            },
            set_size: function (size) {
                payload = {
                    "command": "set_size",
                    "channel": app.channel,
                    "size": size
                };
                send(JSON.stringify(payload));
            },
            make_room_dropdown: function (dropdown, option) {
                this.make_room[dropdown] = option;
            },
            del_invite_list: function (username) {
                for (i = 0; i < this.make_room.invite_list.length; i++) {
                    if (this.make_room.invite_list[i] === username) {
                        this.make_room.invite_list.splice(i, 1);
                        break;
                    }
                }
            },
        }
    })

    function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    async function update_poll() {
        polling = true;
        while (sock.readyState !== 1) {
            await sleep(100);
        }
        console.log("Started polling backend")
        while (!exit) {
            send(JSON.stringify({"command": "update"}));
            await sleep(800);
        }
    }

    function exit_handler() {
        exit = true;
        send(JSON.stringify({"command": "exit_handler"}));
    }

    function setChannel(data) {
        if (app.channel !== data.getAttribute("name")) {
            if (document.getElementById("players")) {
                document.getElementById("players").scrollTo(0, 0);
            }
            app.user_num = 20;
            send(JSON.stringify({"command": "set_user_num", "user_num": app.user_num}));
            app.channel = data.getAttribute("name");
            remove_active_channels();
            document.getElementById(app.channel).classList.add("active");
            send(JSON.stringify({"command": "update"}));
       }
    }

    function remove_active_channels() {
        var ul = document.getElementById("channels");
        var items = ul.getElementsByTagName("li");
        for (var i = 0; i < app.channels.length; ++i) {
            if (app.channels[i] !== app.channel) {
                document.getElementById(app.channels[i]).classList.remove("active")
            }
        }
    }

    function lazy_load(obj) {
        if (obj.scrollTop === (obj.scrollHeight - obj.offsetHeight)) {
            if (app.user_num < app.total_users) {
                app.user_num += 20;
                send(JSON.stringify({"command": "set_user_num", "user_num": app.user_num}));
            }
        }
    }

    function set_logic_profile(profile) {
        payload = {
            "command": "set_logic_profile",
            "channel": app.channel,
            "profile": profile.getAttribute("id")
        };
        send(JSON.stringify(payload));
        send(JSON.stringify({"command": "update"}));
    }

    function start_match() {
        payload = {
            "command": "start_match",
            "channel": app.channel
        };
        send(JSON.stringify(payload));
    }

    function abort_match() {
        payload = {
            "command": "abort_match",
            "channel": app.channel
        };
        send(JSON.stringify(payload));
    }

    function make_room(form) {
        payload = {
            "command": "make_room",
            "title": form.elements.make_room_title.value,
            "password": form.elements.make_room_password.value,
            "game_mode": app.make_room["game_mode"],
            "team_type": app.make_room["team_type"],
            "scoring_type": app.make_room["scoring_type"],
            "logic_profile": app.make_room["logic_profile"],
            "invite_list": app.make_room["invite_list"],
            "size": app.make_room["size"],
            "beatmapID": app.make_room["beatmapID"]
        };
        form.reset();
        app.make_room["game_mode"] = "any";
        app.make_room["team_type"] = "any";
        app.make_room["scoring_type"] = "any";
        app.make_room["logic_profile"] = "";
        app.make_room["invite_list"] = [];
        app.make_room["size"] = 16;
        if (/^[\u0000-\u007f]*$/.test(payload["title"]) && /^[\u0000-\u007f]*$/.test(payload["password"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
    }

    function join_channel(form) {
        payload = {
            "command": "join",
            "channel": form.elements.join_form_channel.value,
        };
        if (payload["channel"] !== "" ) {
            if (/^[\u0000-\u007f]*$/.test(payload["channel"])) {
                send(JSON.stringify(payload));
            } else {
                alert("Sorry, special characters are not currently supported!");
            }
        }
        form.reset();
    }

    async function part_channel(data) {
        payload = {
            "command": "part",
            "channel": data.getAttribute("name"),
        };
        temp = app.channels;
        send(JSON.stringify(payload));
        remove_active_channels();
        while (JSON.stringify(temp) === JSON.stringify(app.channels)) {
            await sleep(100);
        }
        if (app.channels.includes(app.channel)) {
            document.getElementById(app.channel).classList.add("active");
        }
    }

    function send_message(inputObj, channel) {
        message = document.getElementById(inputObj).value;
        document.getElementById(inputObj).value = "";
        payload = {
            "command": inputObj,
            "channel": channel,
            "message": message
        };
        if (/^[\u0000-\u007f]*$/.test(payload["message"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
    }

    function close_room() {
        payload = {
            "command": "close_room",
            "channel": app.channel
        };
        send(JSON.stringify(payload));
    }

    function set_title(form) {
        payload = {
            "command": "set_title",
            "channel": app.channel,
            "title": form.elements.title_input.value
        };
        if (/^[\u0000-\u007f]*$/.test(payload["title"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.reset();
    }

    function set_game_mode(mode) {
        payload = {
            "command": "set_game_mode",
            "channel": app.channel,
            "game_mode": mode
        };
        send(JSON.stringify(payload));
    }

    function set_team_type(type) {
        payload = {
            "command": "set_team_type",
            "channel": app.channel,
            "team_type": type
        };
        send(JSON.stringify(payload));
    }

    function set_scoring_type(type) {
        payload = {
            "command": "set_scoring_type",
            "channel": app.channel,
            "scoring_type": type
        };
        send(JSON.stringify(payload));
    }

    function mod_select_toggle(mod) {
        if (app.mod_select.includes(mod)) {
            for (i = 0; i < app.mod_select.length; i++) {
                if (app.mod_select[i] === mod) {
                    app.mod_select.splice(i, 1);
                    break;
                }
            }
        } else {
            app.mod_select.push(mod);
        }
    }

    function set_mods() {
        payload = {
            "command": "set_mods",
            "channel": app.channel,
            "mods": app.mod_select
        };
        app.mod_select = [];
        send(JSON.stringify(payload));
    }

    function map_status_select_toggle(status) {
        if (app.map_status_select.includes(status)) {
            for (i = 0; i < app.map_status_select.length; i++) {
                if (app.map_status_select[i] === status) {
                    app.map_status_select.splice(i, 1);
                    break;
                }
            }
        } else {
            app.map_status_select.push(status);
        }
    }

    function set_map_status() {
        payload = {
            "command": "set_map_status",
            "channel": app.channel,
            "map_status": app.map_status_select
        };
        app.mod_select = [];
        send(JSON.stringify(payload));
    }

    function set_host() {
        payload = {
            "command": "set_host",
            "channel": app.channel,
            "username": app.current_username
        };
        app.current_username = "";
        send(JSON.stringify(payload));
    }

    function kick_user() {
        payload = {
            "command": "kick_user",
            "channel": app.channel,
            "username": app.current_username
        };
        app.current_username = "";
        send(JSON.stringify(payload));
    }

    function add_broadcast(form) {
        payload = {
            "command": "add_broadcast",
            "channel": app.channel,
            "secs": form.elements.broadcast_secs.value.trim(),
            "message": form.elements.broadcast_message.value.trim()
        };
        if (payload["message"] !== "" && payload["secs"] !== "") {
            if (/^[\u0000-\u007f]*$/.test(payload["message"])) {
                send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        }
        form.elements.broadcast_message.value = "";
    }

    function add_player_blacklist(form) {
        payload = {};
        if (form === null) {
            payload = {
                "command": "add_player_blacklist",
                "channel": app.channel,
                "username": app.current_username,
                "global": false
            };
        } else {
            payload = {
                "command": "add_player_blacklist",
                "channel": app.channel,
                "username": form.elements.blacklist_username.value.trim(),
                "global": form.elements.global_blacklist.checked
            };
        }
        if (payload["username"] !== "") {
            send(JSON.stringify(payload));
        }
        form.elements.blacklist_username.value = "";
    }

    function add_artist_whitelist(form) {
        payload = {
            "command": "add_artist_whitelist",
            "channel": app.channel,
            "artist": form.elements.artist_whitelist_input.value.trim()
        };
        if (/^[\u0000-\u007f]*$/.test(payload["artist"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.elements.artist_whitelist_input.value = "";
    }

    function add_artist_blacklist(form) {
        payload = {
            "command": "add_artist_blacklist",
            "channel": app.channel,
            "artist": form.elements.artist_blacklist_input.value.trim()
        };
        if (/^[\u0000-\u007f]*$/.test(payload["artist"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.elements.artist_blacklist_input.value = "";
    }

    function add_creator_whitelist(form) {
        payload = {
            "command": "add_creator_whitelist",
            "channel": app.channel,
            "creator": form.elements.creator_whitelist_input.value.trim()
        };
        if (/^[\u0000-\u007f]*$/.test(payload["creator"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.elements.creator_whitelist_input.value = "";
    }

    function add_creator_blacklist(form) {
        payload = {
            "command": "add_creator_blacklist",
            "channel": app.channel,
            "creator": form.elements.creator_blacklist_input.value.trim()
        };
        if (/^[\u0000-\u007f]*$/.test(payload["creator"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.elements.creator_blacklist_input.value = "";
    }

    function set_advanced_options() {
        form = document.getElementById("advanced_options_form");
        payload = {
            "command": "set_advanced_options",
            "channel": app.channel,
            "beatmap_checker": form.elements.beatmap_checker_switch.checked,
            "allow_convert": form.elements.allow_conversion_switch.checked,
            "allow_unsubmitted": form.elements.allow_unsubmitted_switch.checked,
            "maintain_title": form.elements.maintain_title_switch.checked,
            "maintain_password": form.elements.maintain_password_switch.checked,
            "maintain_size": form.elements.maintain_size_switch.checked,
            "autostart": form.elements.autostart_switch.checked,
            "autostart_timer": form.elements.autostart_timer_input.value.trim(),
            "welcome_message": form.elements.welcome_message_input.value.trim(),
            "auto_download": form.elements.auto_download_switch.checked,
            "auto_download_path": form.elements.auto_download_path.value.trim(),
            "download_video": form.elements.download_video_switch.checked,
            "auto_open": form.elements.auto_open_switch.checked,
            "redownload_owned_beatmaps": form.elements.redownload_owned_beatmaps.checked,
            "osu_directory": form.elements.osu_directory.value,
        };
        if (!form.elements.autostart_timer_switch.checked) {
            payload["autostart_timer"] = -1;
        }
        if (!form.elements.welcome_message_switch.checked) {
            payload["welcome_message"] = "";
        }
        send(JSON.stringify(payload));
    }

    function reset_advanced_options() {
        form = document.getElementById("advanced_options_form");
        form.elements.beatmap_checker_switch.checked = app.beatmap_checker;
        form.elements.allow_conversion_switch.checked = app.allow_convert;
        form.elements.allow_unsubmitted_switch.checked = app.allow_unsubmitted;
        form.elements.maintain_title_switch.checked = app.maintain_title;
        form.elements.maintain_password_switch.checked = app.maintain_password;
        form.elements.maintain_size_switch.checked = app.maintain_size;
        form.elements.autostart_switch.checked = app.start_on_players_ready;
        form.elements.autostart_timer_switch.checked = app.autostart_timer > 0;
        form.elements.autostart_timer_input.value = app.autostart_timer;
        form.elements.welcome_message_switch.checked = app.welcome_message !== "";
        form.elements.welcome_message_input.value = app.welcome_message;
        form.elements.auto_download_switch.checked = app.auto_download.status;
        form.elements.auto_download_path.value = app.auto_download.path;
        form.elements.download_video_switch.checked = app.auto_download.with_video;
        form.elements.auto_open_switch.checked = app.auto_download.auto_open;
        form.elements.redownload_owned_beatmaps.checked = app.redownload_owned_beatmaps;
        form.elements.osu_directory.value = app.osu_directory;
    }

    function set_password(form) {
        payload = {
            "command": "set_password",
            "channel": app.channel,
            "password": form.elements.password_input.value
        };
        if (/^[\u0000-\u007f]*$/.test(payload["password"])) {
            send(JSON.stringify(payload));
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.elements.password_input.value = "";
    }

    function set_ar_range(form) {
        payload = {
            "command": "set_ar_range",
            "channel": app.channel,
            "range": [form.elements.min_ar.value.trim(), form.elements.max_ar.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function set_od_range(form) {
        payload = {
            "command": "set_od_range",
            "channel": app.channel,
            "range": [form.elements.min_od.value.trim(), form.elements.max_od.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function set_cs_range(form) {
        payload = {
            "command": "set_cs_range",
            "channel": app.channel,
            "range": [form.elements.min_cs.value.trim(), form.elements.max_cs.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function set_hp_range(form) {
        payload = {
            "command": "set_hp_range",
            "channel": app.channel,
            "range": [form.elements.min_hp.value.trim(), form.elements.max_hp.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function set_bpm_range(form) {
        payload = {
            "command": "set_bpm_range",
            "channel": app.channel,
            "range": [form.elements.min_bpm.value.trim(), form.elements.max_bpm.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function set_length_range(form) {
        payload = {
            "command": "set_length_range",
            "channel": app.channel,
            "range": [form.elements.min_length.value.trim(), form.elements.max_length.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function set_diff_range(form) {
        payload = {
            "command": "set_diff_range",
            "channel": app.channel,
            "range": [form.elements.min_diff.value.trim(), form.elements.max_diff.value.trim()]
        };
        send(JSON.stringify(payload));
    }

    function add_invite_list(form) {
        if (/^[\u0000-\u007f]*$/.test(form.elements.invite_players_input.value)) {
            if (form.elements.invite_players_input.value !== "" && !app.make_room.invite_list.includes(form.elements.invite_players_input.value)) {
                app.make_room.invite_list.push(form.elements.invite_players_input.value);
            }
        } else {
            alert("Sorry, special characters are not currently supported!");
        }
        form.elements.invite_players_input.value = "";
    }

    function authenticate() {
        app.bot_password = document.getElementById("bot_password_input").value;
        document.getElementById("bot_password_input").value = "";
        document.getElementById("bot_password_validation").innerHTML = "Password incorrect!";
        document.cookie = JSON.stringify({"bot_password": app.bot_password});
    }

    function send(message) {
        if (app.authenticate) {
            message = encrypt(message);
        }
        sock.send(message);
    }

    function encrypt(message) {
         var encrypted = CryptoJS.AES.encrypt(message, app.bot_password);
         return encrypted.toString();
     }

     function decrypt(message) {
         var decrypted = CryptoJS.AES.decrypt(message, app.bot_password);
         return decrypted.toString(CryptoJS.enc.Utf8);
     }
</script>

</body>
</html>
